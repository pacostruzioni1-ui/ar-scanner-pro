<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PACOSTRUZIONI - Scanner Pro Precision</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; }
        #ui-controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-evenly; z-index: 100; }
        button { padding: 18px; border-radius: 12px; border: none; font-weight: bold; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); active { transform: scale(0.95); } }
        .btn-wall { background: #27ae60; color: white; }
        .btn-infisso { background: #2980b9; color: white; }
        .btn-save { background: #d35400; color: white; }
        #status-bar { position: absolute; top: 20px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; border-left: 5px solid #27ae60; }
        #plan-container { position: absolute; top: 120px; right: 20px; width: 220px; height: 220px; background: rgba(255,255,255,0.05); border: 2px solid #555; border-radius: 15px; overflow: hidden; }
        canvas { width: 100%; height: 100%; }
        .label { font-size: 12px; color: #aaa; text-transform: uppercase; margin-bottom: 5px; }
        .value { font-size: 18px; font-weight: bold; color: #2ecc71; }
    </style>
</head>
<body>

    <div id="status-bar">
        <div class="label">Rilievo Appartamento Nocera Superiore</div>
        <div id="data-display">
            <span class="value" id="mq-val">0.00</span> Mq | 
            <span class="value" id="wall-count">0</span> Punti
        </div>
        <div style="font-size: 11px; margin-top: 5px; color: #f1c40f;">Impianti Full Electric & Domotica</div>
    </div>

    <div id="plan-container">
        <canvas id="planCanvas"></canvas>
    </div>

    <div id="ui-controls">
        <button class="btn-wall" onclick="regPoint('muro')">+ MURO</button>
        <button class="btn-infisso" onclick="regPoint('infisso')">+ INFISSO</button>
        <button class="btn-save" onclick="savePdf()">SALVA PDF</button>
    </div>

    <script>
        let rilievo = [];
        const canvas = document.getElementById('planCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 400;

        function regPoint(tipo) {
            // Simulazione sensore iPhone per rilievo reale
            const last = rilievo.length > 0 ? rilievo[rilievo.length-1] : {x: 200, y: 200};
            const angle = (rilievo.length * 90) * (Math.PI / 180);
            const dist = tipo === 'muro' ? 60 : 30;

            const newPoint = {
                x: last.x + Math.cos(angle) * dist,
                y: last.y + Math.sin(angle) * dist,
                t: tipo
            };

            rilievo.push(newPoint);
            aggiornaMappa();
            calcolaDati();
        }

        function aggiornaMappa() {
            ctx.clearRect(0,0,400,400);
            ctx.setLineDash([]);
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(200, 200);

            rilievo.forEach(p => {
                ctx.lineTo(p.x, p.y);
                if(p.t === 'infisso') {
                    ctx.strokeStyle = "#3498db";
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.strokeStyle = "#fff";
                }
            });
            ctx.stroke();
            
            // Segna punti
            rilievo.forEach(p => {
                ctx.fillStyle = p.t === 'muro' ? "#27ae60" : "#3498db";
                ctx.beginPath();
                ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
                ctx.fill();
            });
        }

        function calcolaDati() {
            document.getElementById('wall-count').innerText = rilievo.length;
            if(rilievo.length > 3) {
                const areaFake = (Math.random() * (100 - 80) + 80).toFixed(2);
                document.getElementById('mq-val').innerText = areaFake;
            }
        }

        function savePdf() {
            alert("Planimetria Tecnica generata!\nIl file Ã¨ stato salvato nei 'File' del tuo iPhone.\nPronto per gestione Domotica e Pompe di Calore.");
        }
    </script>
</body>
</html>
